<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cubo Musical 3D</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      height: 100vh;
      width: 100vw;
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden;
      touch-action: none;
      display: flex;
      justify-content: center;
      align-items: center;
      background: url('assets/fondo.jpg') no-repeat center center fixed;
      background-size: cover;
      position: relative;
    }

    .scene {
      width: 300px;
      height: 300px;
      perspective: 1000px;
      position: relative;
      z-index: 10;
    }

    .cube {
      width: 100%;
      height: 100%;
      position: absolute;
      transform-style: preserve-3d;
      transition: transform 0.1s linear;
    }

    .face {
      position: absolute;
      width: 300px;
      height: 300px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      border: 2px solid red;
      box-shadow: 0 0 20px red;
      animation: parpadeo 1.2s infinite alternate;
    }

    .front  { transform: translateZ(150px); background-image: url('assets/cara1.jpg'); }
    .back   { transform: rotateY(180deg) translateZ(150px); background-image: url('assets/cara2.jpg'); }
    .right  { transform: rotateY(90deg) translateZ(150px); background-image: url('assets/cara3.jpg'); }
    .left   { transform: rotateY(-90deg) translateZ(150px); background-image: url('assets/cara4.jpg'); }
    .top    { transform: rotateX(90deg) translateZ(150px); background-image: url('assets/cara5.jpg'); }
    .bottom { transform: rotateX(-90deg) translateZ(150px); background-image: url('assets/cara6.jpg'); }

    @keyframes parpadeo {
      0%   { border-color: red; box-shadow: 0 0 20px red; }
      100% { border-color: black; box-shadow: 0 0 20px black; }
    }

    .rain-symbol {
      position: absolute;
      top: -50px;
      font-size: 24px;
      color: #fff;
      opacity: 0.6;
      animation: fall 6s linear forwards;
      z-index: 1;
      pointer-events: none;
    }

    @keyframes fall {
      to {
        transform: translateY(110vh);
        opacity: 0;
      }
    }

    #audioPlayer {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
    }
  </style>
</head>
<body>

  <div class="scene">
    <div class="cube" id="cube">
      <div class="face front"  data-index="0"></div>
      <div class="face back"   data-index="1"></div>
      <div class="face right"  data-index="2"></div>
      <div class="face left"   data-index="3"></div>
      <div class="face top"    data-index="4"></div>
      <div class="face bottom" data-index="5"></div>
    </div>
  </div>

  <audio id="audioPlayer" controls></audio>

  <script>
    const cube = document.getElementById("cube");
    const audio = document.getElementById("audioPlayer");
    const faces = document.querySelectorAll(".face");
    const symbols = ["|-/", "ψ", "tΦp", "Ø"];
    const canciones = [
      "assets/cancion1.mp3",
      "assets/cancion2.mp3",
      "assets/cancion3.mp3",
      "assets/cancion4.mp3",
      "assets/cancion5.mp3",
      "assets/cancion6.mp3"
    ];

    let rotateX = -30;
    let rotateY = 30;
    let startX, startY, isDragging = false;
    let lluviaInterval = null;
    let currentSongIndex = -1;

    function updateRotation() {
      cube.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
    }

    function startDrag(x, y) {
      isDragging = true;
      startX = x;
      startY = y;
    }

    function drag(x, y) {
      if (!isDragging) return;
      const deltaX = x - startX;
      const deltaY = y - startY;
      rotateY += deltaX * 0.5;
      rotateX -= deltaY * 0.5;
      startX = x;
      startY = y;
      updateRotation();
    }

    function endDrag() {
      isDragging = false;
    }

    document.addEventListener("mousedown", e => startDrag(e.clientX, e.clientY));
    document.addEventListener("mousemove", e => drag(e.clientX, e.clientY));
    document.addEventListener("mouseup", endDrag);
    document.addEventListener("touchstart", e => startDrag(e.touches[0].clientX, e.touches[0].clientY));
    document.addEventListener("touchmove", e => drag(e.touches[0].clientX, e.touches[0].clientY));
    document.addEventListener("touchend", endDrag);

    function crearSimbolo() {
      const el = document.createElement("div");
      el.className = "rain-symbol";
      el.innerText = symbols[Math.floor(Math.random() * symbols.length)];
      el.style.left = Math.random() * 100 + "vw";
      el.style.fontSize = (20 + Math.random() * 15) + "px";
      el.style.animationDuration = (5 + Math.random() * 3) + "s";
      document.body.appendChild(el);
      setTimeout(() => document.body.removeChild(el), 8000);
    }

    function iniciarLluvia() {
      if (lluviaInterval) clearInterval(lluviaInterval);
      lluviaInterval = setInterval(crearSimbolo, 300);
    }

    function detenerLluvia() {
      clearInterval(lluviaInterval);
    }

    function reproducirCancionDesdeInicio(index) {
      if (index >= canciones.length) index = 0;
      currentSongIndex = index;
      audio.src = canciones[index];
      audio.currentTime = 0;
      audio.play();
      iniciarLluvia();
    }

    audio.addEventListener("ended", () => {
      detenerLluvia();
      reproducirCancionDesdeInicio((currentSongIndex + 1) % canciones.length);
    });

    faces.forEach(face => {
      let tapCount = 0;
      let tapTimer = null;
      const index = parseInt(face.getAttribute("data-index"));

      const handleTap = () => {
        tapCount++;
        if (tapTimer) clearTimeout(tapTimer);

        tapTimer = setTimeout(() => {
          const isSameSong = audio.src.includes(canciones[index]);

          if (tapCount === 1) {
            if (!isSameSong) {
              reproducirCancionDesdeInicio(index);
            } else {
              if (audio.paused) {
                audio.play();
                iniciarLluvia();
              } else {
                audio.pause();
                detenerLluvia();
              }
            }
          } else if (tapCount === 2 && isSameSong) {
            reproducirCancionDesdeInicio(index);
          }

          tapCount = 0;
        }, 400);
      };

      face.addEventListener("click", handleTap);
      face.addEventListener("touchend", handleTap);
    });
  </script>
</body>
</html>

